<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
		xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
		layout:decorate="~{layouts/mypage_layout}">
		<main class="content-wrapper" layout:fragment="content">
			<style>
				.content-container {
					max-width: 600px;
					min-height: 53vh;
					margin: 0 auto;
				}
				.content-container-hedaer {
					max-width: 1200px;
					margin: 0 auto;
				}
			</style>
			<div class="content-container-hedaer justify-content-center text-center">
				<th:block th:replace="fragments/mypageTabs :: mypageTabs(${activeMenu})"></th:block>
			</div>
			<div class="content-container justify-content-center text-center">
				
				<th:block th:if="${session.memberInfo == null}">
					<div class="rounded-lg p-4 h-90 overflow-y-auto text-sm text-gray-700 leading-relaxed mb-5">
						<div class="gap-3 bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6">
							<p class="text-lg font-bold mb-2">비밀번호 확인</p>
							<p class="text-sm leading-relaxed">
								<strong class="text-gray-500">회원정보 변경을 위해 고객님의 본인 확인 절차가 필요하며,<br>비밀번호 입력을 부탁드립니다.</strong>
							</p>
						</div>
						<!-- 비밀번호 -->
						<div class="mb-4">
							<label for="pwd" class="block mb-2 text-sm font-bold text-gray-700 text-start">비밀번호 확인<font color="red"> *</font></label>
							<input type="password" name="pwd" id="pwd" autofocus placeholder="비밀번호를 입력해 주세요." maxlength="20" onkeypress="enterKey()"
								class="w-full px-4 py-3 border border-gray-300 text-lg rounded focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent">
						</div>
						<!-- 로그인 버튼 -->
						<button type="button" class="w-full py-3 font-bold text-white bg-black rounded hover:bg-gray-800 transition-colors" onclick="fnLogin()">
							확인
						</button>
					</div>
				</th:block>
				<th:block th:if="${session.memberInfo != null}">
					<div class="bg-white rounded-2xl card-shadow p-10">
						<div class="flex justify-center mb-6">
							<div class="w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center">
								<i class="fas fa-user text-2xl text-gray-400"></i>
							</div>
						</div>
					
						<h3 class="text-lg font-semibold text-gray-700 text-center mb-8">
							내 정보 관리
						</h3>
					
						<div class="space-y-4 text-sm">
							<div class="flex justify-between border-b pb-3">
								<span class="text-gray-500">고객명</span>
								<span class="text-gray-800 font-medium" th:text="${getMember.userNm}"></span>
							</div>
					
							<div class="flex justify-between border-b pb-3">
								<span class="text-gray-500">이메일</span>
								<span class="text-gray-800 font-medium" th:text="${getMember.userEmail}"></span>
							</div>
					
							<div class="flex justify-between border-b pb-3">
								<span class="text-gray-500">연락처</span>
								<span class="text-gray-800 font-medium" th:text="${getMember.userMobile}"></span>
							</div>
						</div>
						
						<div class="mt-8 text-center">
						    <button type="button"
						            onclick="deleteMember()"
						            class="inline-flex items-center px-6 py-3 bg-green-600 text-white text-sm font-semibold rounded-full hover:bg-green-700 transition">
						        회원탈퇴
						    </button>
						</div>
					</div>
				</th:block>
			</div>
			
			<script th:inline="javascript">
				fnLogin = function(){
					let pwd = $('#pwd').val();
					
					if(pwd == ""){
						alert("비밀번호를 입력해 주세요.")
						$('#pwd').focus();
						return;
					}
					let loginInfo = {
						userPw : pwd
					}
					$.ajax({
						url : "/rest/member/memberInfoAjax",
						type : "POST",
						dataType : "json",
						data : loginInfo,
						success : function(data) {
							console.log(data)
							if(data.data.RESULT == "SUCCESS"){
								location.reload();
							} else if(data.data.RESULT == "NONE"){
								location.reload();
							} else {
								alert("비밀번호가 정확하지 않습니다.");
								$('#userPw').val("");
							}
						}, error : function(request, status, error) {
							alert("에러코드: " + request.status + "\n메시지: " + request.responseText);
						}
					});
				}
				enterKey = function(type){
					if (window.event.keyCode == 13) {
						fnLogin();
					}
				}
				
				deleteMember = function (addressSeq){
					if (!confirm("정말 탈퇴하시겠습니까?")) {
						return;
					}
					$.ajax({
						url : "/rest/member/delete",
						type : "POST",
						dataType : "json",
						success : function(data) {
							location.href="/main"
						}, error : function(request, status, error) {
							alert("에러코드: " + request.status + "\n메시지: " + request.responseText);
						}
					});
				}
			</script>

		</main>
</html>