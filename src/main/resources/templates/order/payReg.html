<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/mypage_layout}">
	<main class="container mx-auto px-4" layout:fragment="content">
		<script src="https://js.tosspayments.com/v2/standard"></script>
		<script th:inline="javascript">
			const clientKey = /*[[${clientKey}]]*/"";
		</script>
		<script src="/js/tosspay.js"></script>
		<link rel="stylesheet" href="/css/custom/payReg.css">
		
		<!-- Page Title -->
		<div class="text-center mb-8">
			<h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">
				<i class="fas fa-clipboard-list text-blue-500 mr-2"></i>
				주문서 작성
			</h1>
			<p class="text-gray-600">맛있는 반찬과 함께 행복한 식사</p>
		</div>
		
		<!-- Desktop Layout -->
		<div class="hidden md:block space-y-8 mb-2">
			<!-- Order Information -->
			<div class="bg-white rounded-lg shadow-lg p-6 order-table">
				<h2 class="text-xl font-bold mb-4 text-gray-800">
					<i class="fas fa-receipt text-blue-500 mr-2"></i>
					주문 정보
				</h2>
				<div class="overflow-x-auto">
					<table class="w-full text-base" id="myTable">
						<thead class="bg-gray-800 text-white">
							<tr>
								<th class="px-4 py-3 text-left">식단정보</th>
								<th class="px-4 py-3 text-center">총수량</th>
								<th class="px-4 py-3 text-right">판매가</th>
								<th class="px-4 py-3 text-right">소계</th>
								<th class="px-4 py-3 text-right">배송비</th>
							</tr>
						</thead>
						<tbody class="divide-y divide-gray-200">
							<tr th:each="rs,rsStat : ${order.productList}">
								<td class="px-4 py-4">
									<div class="font-medium" th:text="${#temporals.createDate(rs.menuDay, 'yyyyMMdd')} + ' (' + ${#temporals.dayOfWeekName(#temporals.createDate(rs.menuDay, 'yyyyMMdd'))} + ')'"></div>
									<div class="text-gray-600 text-sm">
										<th:block th:if="${rs.orderSet == '1000'}">
											<th:block th:each="msg,msgStat : ${#strings.setSplit(rs.menuMsg,'|')}">
												<th:block th:if="${#strings.substring(msg,0,1) == '!'}">
													<span class="text-red-600 font-medium" th:text="${#strings.substring(msg,1)}"></span>
													<span th:text="'(' + ${#strings.arraySplit(rs.menuMsgDetail ?: '', '|')[msgStat.index]} + '개)'"></span>
												</th:block>
												<th:block th:if="${#strings.substring(msg,0,1) != '!'}">
													<span th:text="${msg}"></span>
													<span th:text="'(' + ${#strings.arraySplit(rs.menuMsgDetail ?: '', '|')[msgStat.index]} + '개)'"></span>
												</th:block>
												<th:block th:if="${msgStat.last == false}"><br></th:block>
											</th:block>
										</th:block>
						
										<th:block th:if="${rs.orderSet == '2000' || rs.orderSet == '3000'}">
											<th:block th:each="msg,msgStat : ${#strings.setSplit(rs.menuMsg,'|')}">
												<th:block th:if="${#strings.substring(msg,0,1) == '!'}">
													<span class="text-red-600 font-medium" th:text="${#strings.substring(msg,1)}"></span>
												</th:block>
												<th:block th:if="${#strings.substring(msg,0,1) != '!'}">
													<span th:text="${msg}"></span>
												</th:block>
											</th:block>
										</th:block>
									</div>
								</td>
								<td class="px-4 py-4 text-center">
									<span class="orderQty" th:text="${rs.orderQty}"></span>
								</td>
								<td class="px-4 py-4 text-right">
									<th:block th:if="${rs.orderSet == '1000' || rs.orderSet == '3000'}">
										<span th:text="${rs.totalQty >= 15 ? #numbers.formatInteger(17000, 3, 'COMMA') : #numbers.formatInteger(18000, 3, 'COMMA')}"></span>
									</th:block>
									<th:block th:if="${rs.orderSet == '2000'}">
										<span th:text="${#numbers.formatInteger(9000, 3, 'COMMA')}"></span>
									</th:block>
								</td>
								<td class="px-4 py-4 text-right text-red-600 font-bold">
									<span class="subAmount" th:text="${#numbers.formatInteger(rs.payAmt, 3, 'COMMA')}"></span>
								</td>
								<td th:if="${rsStat.first == true}" th:rowspan="${order.productList.size}" class="px-4 py-4 text-right text-red-600">
									<span id="delivAmount" th:text="${order.totalDelyAmt == 0 ? '무료' : #numbers.formatInteger(order.totalDelyAmt, 3, 'COMMA')}"></span>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div class="pt-4 border-t border-gray-200">
					<div class="flex justify-between items-center">
						<span class="text-lg font-bold">총 주문금액</span>
						<span class="text-2xl font-bold text-green-600" id="totalAmount" th:text="${#numbers.formatInteger(order.totalAmount + order.totalDelyAmt,3,'COMMA')}+'원'"></span>
					</div>
				</div>
			</div>
			<form id="pc_form" method="post" onsubmit="return false;">
				<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
					<!-- Left Column -->
					<div class="space-y-6">
						<!-- Orderer Information -->
						<div class="bg-white rounded-lg shadow-lg p-6">
							<h2 class="text-xl font-bold mb-4 text-gray-800">
								<i class="fas fa-user text-blue-500 mr-2"></i>
								주문하시는 분
							</h2>
							<div class="space-y-4">
								<div>
									<label for="o_name" class="block text-sm font-medium text-gray-700 mb-2"><font color="red">* </font>이름</label>
									<input type="text" id="o_name" name="orderName" maxlength="10" class="w-full px-3 py-2 border border-gray-300 rounded-md input-focus" placeholder="이름을 입력하세요">
								</div>
								<div>
									<label for="o_pass" class="block text-sm font-medium text-gray-700 mb-2"><font color="red">* </font>비밀번호</label>
									<input type="password" id="o_pass" name="orderPwd" maxlength="20" class="w-full px-3 py-2 border border-gray-300 rounded-md input-focus" placeholder="영,숫자 3~20자 (주문서 조회시 필요)">
								</div>
								<div>
									<label for="o_tel" class="block text-sm font-medium text-gray-700 mb-2">전화번호</label>
									<input type="text" id="o_tel" name="orderTel" class="phoneNumber w-full px-3 py-2 border border-gray-300 rounded-md input-focus">
								</div>
								<div>
									<label for="o_phone" class="block text-sm font-medium text-gray-700 mb-2"><font color="red">* </font>핸드폰</label>
									<input type="text" id="o_phone" name="orderPhone" class="phoneNumber w-full px-3 py-2 border border-gray-300 rounded-md input-focus">
								</div>
								<div>
									<label for="o_address" class="block text-sm font-medium text-gray-700 mb-2">
										<span class="text-red-500">*</span> 주소
									</label>
									<!-- 우편번호 + 버튼 -->
									<div class="flex gap-2 mb-2">
										<input type="text" id="o_postNum" name="orderPostNum" class="flex-1 px-3 py-2 border border-gray-300 rounded-md bg-gray-100" placeholder="우편번호" readonly>
										<button type="button" onclick="execDaumPostcode()" class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 shrink-0">주소검색</button>
									</div>
									<!-- 주소 검색 결과 iframe -->
									<div id="wrap3" class="w-full border border-gray-300 rounded-md mb-2" style="display: none; height: 300px; position: relative;">
										<img src="//t1.daumcdn.net/postcode/resource/images/close.png" id="btnFoldWrap" alt="접기 버튼" class="absolute top-0 right-0 cursor-pointer z-10" onclick="foldDaumPostcode()">
									</div>
									<!-- 기본주소 -->
									<input type="text" id="o_addr" name="orderAddr" class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 mb-2" placeholder="기본주소" readonly>
									<!-- 상세주소 -->
									<input type="text" id="o_addrDetail" name="orderAddrDetail" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="상세주소를 입력하세요">
								</div>
								<div>
									<label for="o_email" class="block text-sm font-medium text-gray-700 mb-2"><font color="red">* </font>이메일</label>
									<div class="flex flex-wrap items-center gap-2">
										<input type="text" name="copyEmail" id="o_email" maxlength="30" class="border border-gray-300 rounded px-3 py-2 w-1/3" placeholder="이메일 아이디">
										<span class="mt-1">@</span>
										<input type="text" name="copyEmail2" id="o_email2" maxlength="30" class="border border-gray-300 rounded px-3 py-2 w-1/3" placeholder="이메일 도메인">
										<select name="emailSelect" class="border border-gray-300 rounded px-3 py-2 w-1/4 bg-white" onchange="res(this.value)">
											<option value="">직접입력</option>
											<option value="naver.com">naver.com</option>
											<option value="daum.net">daum.net</option>
											<option value="hanmail.net">hanmail.net</option>
											<option value="nate.com">nate.com</option>
											<option value="gmail.com">gmail.com</option>
										</select>
										<input type="text" id="od_email" name="orderEmail" maxlength="20" class="hidden">
									</div>
								</div>
							</div>
						</div>
					</div>
	
					<!-- Right Column -->
						<!-- Recipient Information -->
					<div class="bg-white rounded-lg shadow-lg p-6">
						<div class="flex justify-between items-center mb-4">
							<h2 class="text-xl font-bold text-gray-800 flex items-center">
								<i class="fas fa-user-friends text-blue-500 mr-2"></i>
								받으시는 분
							</h2>
							<label for="check1" class="flex items-center space-x-2 cursor-pointer">
								<input id="check1" type="checkbox" class="check1 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
								<span class="text-sm text-gray-700">주문자와 동일</span>
							</label>
						</div>
						<div class="space-y-4">
							<div>
								<label for="r_name" class="block text-sm font-medium text-gray-700 mb-2"><font color="red">* </font>이름</label>
								<input type="text" id="r_name" name="receiveName" maxlength="10" class="w-full px-3 py-2 border border-gray-300 rounded-md input-focus" placeholder="이름을 입력하세요">
							</div>
							<div>
								<label for="r_tel" class="block text-sm font-medium text-gray-700 mb-2">전화번호</label>
								<input type="text" id="r_tel" name="receiveTel" class="phoneNumber w-full px-3 py-2 border border-gray-300 rounded-md input-focus">
							</div>
							<div>
								<label for="r_phone" class="block text-sm font-medium text-gray-700 mb-2"><font color="red">* </font>핸드폰</label>
								<input type="text" id="r_phone" name="receivePhone" class="phoneNumber w-full px-3 py-2 border border-gray-300 rounded-md input-focus">
							</div>
							<div>
								<label for="r_address" class="block text-sm font-medium text-gray-700 mb-2">
									<span class="text-red-500">*</span> 주소
								</label>
								<!-- 우편번호 + 버튼 -->
								<div class="flex gap-2 mb-2">
									<input type="text" id="r_postNum" name="receivePostNum" class="flex-1 px-3 py-2 border border-gray-300 rounded-md bg-gray-100" placeholder="우편번호" readonly>
									<button type="button" onclick="execDaumPostcode2()"class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 shrink-0">주소검색</button>
								</div>
								<!-- 주소 검색 결과 iframe -->
								<div id="wrap2" class="w-full border border-gray-300 rounded-md mb-2" style="display: none; height: 300px; position: relative;">
									<img src="//t1.daumcdn.net/postcode/resource/images/close.png" id="btnFoldWrap" alt="접기 버튼" class="absolute top-0 right-0 cursor-pointer z-10" onclick="foldDaumPostcode2()">
								</div>
								<!-- 기본주소 -->
								<input type="text" id="r_addr" name="receiveAddr" class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 mb-2" placeholder="기본주소" readonly>
								<!-- 상세주소 -->
								<input type="text" id="r_addrDetail" name="receiveAddrDetail" class="w-full px-3 py-2 border border-gray-300 rounded-md" autocomplete="off" placeholder="상세주소를 입력하세요">
							</div>
						</div>
					</div>
				</div>
				<!-- Additional Options -->
				<div class="bg-white rounded-lg shadow-lg p-6 mt-4">
					<h2 class="text-xl font-bold mb-4 text-gray-800">
						<i class="fas fa-cogs text-blue-500 mr-2"></i>
						추가 옵션
					</h2>
					<div class="space-y-6">
						<label class="block text-sm font-medium text-gray-700">
							<label class="block text-sm font-medium text-gray-700 mb-2"><font color="red">* </font>배송유형</label>
						</label>
						<div class="flex flex-col sm:flex-row gap-4">
							<label for="radio1" class="flex items-center space-x-2 cursor-pointer">
								<input type="radio" name="delivKind" id="radio1" value="1000" class="form-radio text-blue-600 focus:ring-blue-500">
								<span class="text-sm text-gray-700">당일배송(안산)</span>
							</label>
							<label for="radio2" class="flex items-center space-x-2 cursor-pointer" data-bs-toggle="tooltip" data-bs-placement="top" title="택배비 4,000원이 추가됩니다.">
								<input type="radio" name="delivKind" id="radio2" value="2000" class="form-radio text-blue-600 focus:ring-blue-500">
								<span class="text-sm text-gray-700">우체국 택배(안산 외)</span>
							</label>
						</div>
						<div>
							<label id="packagingFocus" class="block text-sm font-medium text-gray-700 mb-2"><font color="red">* </font>포장가방</label>
							<div class="grid grid-cols-3 gap-3">
								<div data-bind="a" class="packaging-option border-2 border-gray-200 rounded-lg p-3 text-center cursor-pointer" data-bs-toggle="tooltip" data-bs-placement="top" title="보증금 5,000원이 추가됩니다.">
									<div class="w-16 h-16 bg-gray-100 rounded-lg mx-auto mb-2 flex items-center justify-center">
										<img src="/image/packaging_1.jpg" alt="보냉가방(신규)">
									</div>
									<input type="radio" name="packaging" value="1000" class="hidden" id="radio3">
									<span class="text-sm font-medium">보냉가방(신규)</span>
								</div>
								<div data-bind="b" class="packaging-option border-2 border-gray-200 rounded-lg p-3 text-center cursor-pointer">
									<div class="w-16 h-16 bg-gray-100 rounded-lg mx-auto mb-2 flex items-center justify-center">
										<img src="/image/packaging_1.jpg" alt="보냉가방(기존사용자)">
									</div>
									<input type="radio" name="packaging" value="2000" class="hidden" id="radio4">
									<span class="text-sm font-medium">보냉가방(기존)</span>
								</div>
								<div data-bind="c" class="packaging-option border-2 border-gray-200 rounded-lg p-3 text-center cursor-pointer">
									<div class="w-16 h-16 bg-gray-100 rounded-lg mx-auto mb-2 flex items-center justify-center">
										<img src="/image/packaging_2.jpg" alt="종이가방">
									</div>
									<input type="radio" name="packaging" value="3000" class="hidden" id="radio5">
									<span class="text-sm font-medium">종이가방</span>
								</div>
							</div>
							<label class="block text-sm font-medium text-gray-700 text-secondary mt-2">※해당 이미지는 참고용 이미지 이므로 실제 포장가방과는 다를 수 있습니다.</label>
						</div>
						<div>
							<label for="r_commonPwd" class="block text-sm font-medium text-gray-700 mb-2">공동현관 비밀번호</label>
							<input type="text" id="commonPwd" name="commonPwd" class="w-full px-3 py-2 border border-gray-300 rounded-md input-focus" placeholder="비밀번호 입력 예시: 종버튼 + 1234" maxlength="50">
						</div>
						<div>
							<label for="r_bigo" class="block text-sm font-medium text-gray-700 mb-2">전하실 말씀</label>
							<textarea id="r_bigo" name="bigo" class="w-full px-3 py-2 border border-gray-300 rounded-md input-focus" maxlength="300" rows="3" style="resize: none;" placeholder="배송 시에 찾기 어려운 곳이나 기타 사항이 있는 경우 원활한 배송을 위해 기입해 주시기 바랍니다 :)"></textarea>
						</div>
						<div class="mb-6">
							<div class="bg-gray-50 border border-gray-200 rounded-lg p-4 text-sm text-gray-700">
								<p class="font-semibold mb-2">[결제 후 배송 및 환불 정책]</p>
								<ul class="list-disc list-inside space-y-1">
									<li>결제 후 <strong>6주 이내</strong>로 제품을 받을 수 있습니다. <span class="text-gray-500">(월별 선결제건 포함)</span></li>
									<li>환불 요청 후 <strong>7일 이내</strong>로 환불 처리가 완료됩니다.</li>
								</ul>
							</div>
						</div>
						<div>
							<label class="flex items-center space-x-2 cursor-pointer">
								<input type="checkbox" class="agree rounded border-gray-300 text-blue-600 focus:ring-blue-500">
								<span class="text-sm text-gray-700">주문 내용 확인 및 결제 진행에 동의합니다</span>
							</label>
						</div>
					</div>
				</div>
	
				<!-- Action Buttons -->
				<div class="flex space-x-4 mt-3">
					<button type="button" onclick="fnSubmit()" class="flex-1 btn btn-outline-primary btn-lg ms-1 py-3 px-6 rounded-lg font-medium">
						<i class="fas fa-credit-card mr-2"></i>결제하기
					</button>
					<button type="button" onclick="window.history.back();" class="flex-1 btn btn-outline-danger py-3 px-6 rounded-lg font-medium">
						<i class="fas fa-times mr-2"></i>취소
					</button>
				</div>
			</form>
			<button type="button" style="display:none;" class="btn btn-primary" id="modalPay" data-bs-toggle="modal" data-bs-target="#staticBackdrop"></button>
			<!-- Modal -->
		</div>
		
		<!-- Mobile Slide Layout -->
		<div class="md:hidden">
			<!-- Step 1: Order Information -->
			<div class="w-full mb-5">
				<div class="bg-white rounded-lg shadow-lg p-6">
					<h2 class="text-xl font-bold mb-4 text-gray-800">
						<i class="fas fa-receipt text-blue-500 mr-2"></i>
						주문 정보
					</h2>
					<div class="space-y-4">
						<div th:each="rs,rsStat : ${order.productList}" class="bg-gray-50 p-3 rounded-lg">
							<div class="text-xs font-bold flex justify-between items-center mb-1">
								<span th:text="${#temporals.createDate(rs.menuDay, 'yyyyMMdd')} + ' (' + ${#temporals.dayOfWeekName(#temporals.createDate(rs.menuDay, 'yyyyMMdd'))} + ')'"></span>
								<div th:switch="${rs.delivTime}">
									<div th:case="'1000'" class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium inline-flex items-center">
										<i class="fas fa-shipping-fast mr-2"></i>
										오전배달
									</div>
									<div th:case="'2000'" class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium inline-flex items-center">
										<i class="fas fa-shipping-fast mr-2"></i>
										오후배달
									</div>
								</div>
							</div>
							<th:block th:each="msg,msgStat : ${#strings.setSplit(rs.menuMsg,'|')}">
								<th:block th:if="${rs.orderSet == '1000'}">
									<th:block th:if="${#strings.substring(msg,0,1) == '!'}">
										<div th:text="${#strings.substring(msg,1) + ' (' + #strings.arraySplit(rs.menuMsgDetail ?: '', '|')[msgStat.index] + '개)'}" class="text-red-600 text-xs text-gray-600 mb-2"></div>
									</th:block>
									<th:block th:if="${#strings.substring(msg,0,1) != '!'}">
										<div th:text="${msg + ' (' + #strings.arraySplit(rs.menuMsgDetail ?: '', '|')[msgStat.index] + '개)'}" class="text-xs text-gray-600 mb-2"></div>
									</th:block>
								</th:block>
								<th:block th:if="${rs.orderSet == '2000' || rs.orderSet == '3000'}">
									<th:block th:if="${#strings.substring(msg,0,1) == '!'}">
										<span th:text="${#strings.substring(msg,1)}" class="text-red-600 text-xs text-gray-600 mb-2"></span>
									</th:block>
									<th:block th:if="${#strings.substring(msg,0,1) != '!'}">
										<span th:text="${msg}" class="text-xs text-gray-600 mb-2"></span>	
									</th:block>
									<th:block th:if="${msgStat.count % 3 == 0}"><br></th:block>
								</th:block>
							</th:block>
							<div class="mt-3 flex justify-between items-center">
								<span th:text="${'수량: '+rs.orderQty}" class="text-sm"></span>
								<span th:text="${#numbers.formatInteger(rs.payAmt, 3, 'COMMA')}" class="text-sm font-bold text-red-600"></span>
							</div>
						</div>
						<div class="bg-gray-50 p-4 rounded-lg" id="delivDiv">
							<div class="flex justify-between items-center">
								<span class="text-sm">배송비</span>
								<span id="delivAmount_mo" th:text="${order.totalDelyAmt == 0 ? '무료' : #numbers.formatInteger(order.totalDelyAmt, 3, 'COMMA')}" class="text-sm font-bold text-red-600"></span>
							</div>
						</div>
						<div class="border-t pt-4">
							<div class="flex justify-between items-center">
								<span class="text-lg font-bold">총 주문금액</span>
								<span id="totalAmount_mo" th:text="${#numbers.formatInteger(order.totalAmount + order.totalDelyAmt,3,'COMMA')}+'원'" class="text-xl font-bold text-green-600"></span>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Step 2: Orderer Information -->
			<form id="mo_form" method="post" onsubmit="return false;">
				<div class="w-full mb-5">
					<div class="bg-white rounded-lg shadow-lg p-6">
						<h2 class="text-xl font-bold mb-4 text-gray-800">
							<i class="fas fa-user text-blue-500 mr-2"></i>
							주문하시는 분
						</h2>
						<div class="space-y-4">
							<div>
								<label for="o_name_mo" class="block text-sm font-medium text-gray-700 mb-2"><font color="red">* </font>이름</label>
								<input type="text" id="o_name_mo" name="orderName" maxlength="10" class="w-full px-3 py-3 border border-gray-300 rounded-md input-focus" placeholder="이름을 입력하세요">
							</div>
							<div>
								<label for="o_pass_mo" class="block text-sm font-medium text-gray-700 mb-2"><font color="red">* </font>비밀번호</label>
								<input type="password" id="o_pass_mo" name="orderPwd" maxlength="20" class="w-full px-3 py-3 border border-gray-300 rounded-md input-focus" placeholder="영,숫자 3~20자 (주문서 조회시 필요)">
							</div>
							<div>
								<label for="o_tel_mo" class="block text-sm font-medium text-gray-700 mb-2">전화번호</label>
								<input type="text" id="o_tel_mo" name="orderTel" class="phoneNumber w-full px-3 py-3 border border-gray-300 rounded-md input-focus">
							</div>
							<div>
								<label for="o_phone_mo" class="block text-sm font-medium text-gray-700 mb-2"><font color="red">* </font>핸드폰</label>
								<input type="text" id="o_phone_mo" name="orderPhone" class="phoneNumber w-full px-3 py-3 border border-gray-300 rounded-md input-focus">
							</div>
							<div>
								<label class="block text-sm font-medium text-gray-700 mb-2"><font color="red">* </font>주소</label>
								<div class="flex space-x-2 mb-2">
									<input type="text" id="o_postNum_mo" name="orderPostNum" class="w-32 px-3 py-3 border border-gray-300 rounded-md input-focus" placeholder="우편번호" readonly>
									<button type="button" onclick="execDaumPostcode()" class="px-4 py-3 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-sm">검색</button>
								</div>
								<div id="wrap3_mo" class="w-full border border-gray-300 rounded-md mb-2" style="display:none; height: 300px; position: relative;">
									<img src="//t1.daumcdn.net/postcode/resource/images/close.png" id="btnFoldWrap" alt="접기 버튼" class="absolute top-0 right-0 cursor-pointer z-10" onclick="foldDaumPostcode()">
								</div>
								<input type="text" id="o_addr_mo" name="orderAddr" class="w-full px-3 py-3 border border-gray-300 rounded-md input-focus mb-2" placeholder="기본주소" readonly>
								<input type="text" id="o_addrDetail_mo" name="orderAddrDetail" class="w-full px-3 py-3 border border-gray-300 rounded-md input-focus" placeholder="상세주소를 입력하세요">
							</div>
							<div>
								<label for="o_email_mo"class="block text-sm font-medium text-gray-700 mb-2"><font color="red">* </font>이메일</label>
								<input type="text" name="copyEmail" id="o_email_mo" maxlength="30" class="w-full px-3 py-3 border border-gray-300 rounded-md input-focus mb-2" placeholder="이메일 아이디">
								<span class="mt-1">@</span>
								<input type="text" name="copyEmail2" id="o_email2_mo" maxlength="30" class="w-full px-3 py-3 border border-gray-300 rounded-md input-focus mb-2" placeholder="이메일 도메인">
								<select name="emailSelect" class="border border-gray-300 rounded px-3 py-2 w-full bg-white" onchange="res(this.value)">
									<option value="">직접입력</option>
									<option value="naver.com">naver.com</option>
									<option value="daum.net">daum.net</option>
									<option value="hanmail.net">hanmail.net</option>
									<option value="nate.com">nate.com</option>
									<option value="gmail.com">gmail.com</option>
								</select>
							</div>
						</div>
					</div>
				</div>
	
				<!-- Step 3: Recipient Information -->
				<div class="w-full mb-5">
					<div class="bg-white rounded-lg shadow-lg p-6">
						<h2 class="text-xl font-bold mb-4 text-gray-800">
							<i class="fas fa-user-friends text-blue-500 mr-2"></i>
							받으시는 분
						</h2>
						<div class="mb-4">
							<label for="check2" class="flex items-center space-x-2 cursor-pointer p-3 bg-gray-50 rounded-lg">
								<input id="check2" type="checkbox" class="check1 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
								<span class="text-sm text-gray-700">주문자와 동일</span>
							</label>
						</div>
						<div class="space-y-4">
							<div>
								<label for="r_name_mo"class="block text-sm font-medium text-gray-700 mb-2"><font color="red">* </font>이름</label>
								<input type="text" id="r_name_mo" name="receiveName" maxlength="10" class="w-full px-3 py-3 border border-gray-300 rounded-md input-focus" placeholder="이름을 입력하세요">
							</div>
							<div>
								<label for="r_tel_mo" class="block text-sm font-medium text-gray-700 mb-2">전화번호</label>
								<input type="text" id="r_tel_mo" name="receiveTel" class="phoneNumber w-full px-3 py-3 border border-gray-300 rounded-md input-focus">
							</div>
							<div>
								<label for="r_phone_mo" class="block text-sm font-medium text-gray-700 mb-2"><font color="red">* </font>핸드폰</label>
								<input type="text" id="r_phone_mo" name="receivePhone" class="phoneNumber w-full px-3 py-3 border border-gray-300 rounded-md input-focus">
							</div>
							<div>
								<label class="block text-sm font-medium text-gray-700 mb-2"><font color="red">* </font>주소</label>
								<div class="flex space-x-2 mb-2">
									<input type="text" id="r_postNum_mo" name="receivePostNum" class="w-32 px-3 py-3 border border-gray-300 rounded-md input-focus" placeholder="우편번호" readonly>
									<button type="button" onclick="execDaumPostcode2()" class="px-4 py-3 bg-gray-600 text-white rounded-md hover:bg-gray-700 text-sm">검색</button>
								</div>
								<div id="wrap2_mo" class="w-full border border-gray-300 rounded-md mb-2" style="display:none; height: 300px; position: relative;">
									<img src="//t1.daumcdn.net/postcode/resource/images/close.png" id="btnFoldWrap" alt="접기 버튼" class="absolute top-0 right-0 cursor-pointer z-10" onclick="foldDaumPostcode2()">
								</div>
								<input type="text" id="r_addr_mo" name="receiveAddr" class="w-full px-3 py-3 border border-gray-300 rounded-md input-focus mb-2" placeholder="기본주소" readonly>
								<input type="text" id="r_addrDetail_mo" name="receiveAddrDetail" class="w-full px-3 py-3 border border-gray-300 rounded-md input-focus" placeholder="상세주소를 입력하세요">
							</div>
						</div>
					</div>
				</div>
	
				<!-- Step 4: Additional Options -->
				<div class="w-full">
					<div class="bg-white rounded-lg shadow-lg p-6">
						<h2 class="text-xl font-bold mb-4 text-gray-800">
							<i class="fas fa-cogs text-blue-500 mr-2"></i>
							추가 옵션
						</h2>
						<div class="space-y-6">
							<div>
								<label class="block text-sm font-medium text-gray-700 mb-3"><font color="red">* </font>배송유형</label>
								<div class="grid grid-cols-2 gap-2">
									<label for="radio1_mo"class="flex items-center space-x-2 cursor-pointer">
										<input type="radio" name="delivKind" id="radio1_mo" value="1000" class="form-radio text-blue-600 focus:ring-blue-500">
										<span class="text-sm text-gray-700">당일배송(안산)</span>
									</label>
									<label for="radio2_mo" class="flex items-center space-x-2 cursor-pointer" data-bs-toggle="tooltip" data-bs-placement="top" title="택배비 4,000원이 추가됩니다.">
										<input type="radio" name="delivKind" id="radio2_mo" value="2000" class="form-radio text-blue-600 focus:ring-blue-500">
										<span class="text-sm text-gray-700">우체국 택배(안산 외)</span>
									</label>
								</div>
							</div>
							<div>
								<label id="packagingFocus_mo" class="block text-sm font-medium text-gray-700 mb-3"><font color="red">* </font>포장가방</label>
								<div class="grid grid-cols-3 gap-3">
									<div data-bind="a" class="packaging-option border-2 border-gray-200 rounded-lg p-3 text-center cursor-pointer" data-bs-toggle="tooltip" data-bs-placement="top" title="보증금 5,000원이 추가됩니다.">
										<div class="w-12 h-12 bg-gray-100 rounded-lg mx-auto mb-2 flex items-center justify-center">
											<img src="/image/packaging_1.jpg" alt="보냉가방(신규)">
										</div>
										<input type="radio" name="packaging" value="1000" class="hidden" id="radio3_mo">
										<span class="text-xs font-medium">보냉가방(신규)</span>
									</div>
									<div data-bind="b" class="packaging-option border-2 border-gray-200 rounded-lg p-3 text-center cursor-pointer">
										<div class="w-12 h-12 bg-gray-100 rounded-lg mx-auto mb-2 flex items-center justify-center">
											<img src="/image/packaging_1.jpg" alt="보냉가방(기존사용자)">
										</div>
										<input type="radio" name="packaging" value="2000" class="hidden" id="radio4_mo">
										<span class="text-xs font-medium">보냉가방(기존)</span>
									</div>
									<div data-bind="c" class="packaging-option border-2 border-gray-200 rounded-lg p-3 text-center cursor-pointer">
										<div class="w-12 h-12 bg-gray-100 rounded-lg mx-auto mb-2 flex items-center justify-center">
											<img src="/image/packaging_2.jpg" alt="종이가방">
										</div>
										<input type="radio" name="packaging" value="3000" class="hidden" id="radio5_mo">
										<span class="text-xs font-medium">종이가방</span>
									</div>
								</div>
								<label class="block text-sm font-medium text-gray-700 text-secondary mt-2">※해당 이미지는 참고용 이미지 이므로 실제 포장가방과는 다를 수 있습니다.</label>
							</div>
							<div>
								<label for="r_commonPwd_mo" class="block text-sm font-medium text-gray-700 mb-2">공동현관 비밀번호</label>
								<input type="text" id="r_commonPwd_mo" name="commonPwd" class="w-full px-3 py-3 border border-gray-300 rounded-md input-focus mb-2" placeholder="비밀번호 입력 예시: 종버튼 + 1234" maxlength="50">
							</div>
							<div>
								<label for="r_bigo_mo" class="block text-sm font-medium text-gray-700 mb-2">전하실 말씀</label>
								<textarea id="r_bigo_mo" name="bigo" class="w-full px-3 py-3 border border-gray-300 rounded-md input-focus" maxlength="300" rows="3" style="resize: none;" placeholder="배송 시에 찾기 어려운 곳이나 기타 사항이 있는 경우 원활한 배송을 위해 기입해 주시기 바랍니다 :)"></textarea>
							</div>
							<div class="mb-6">
								<div class="bg-gray-50 border border-gray-200 rounded-lg p-3 text-xs text-gray-700">
									<p class="font-semibold mb-2">[결제 후 배송 및 환불 정책]</p>
									<ul class="list-disc list-inside space-y-1">
										<li>결제 후 <strong>6주 이내</strong>로 제품을 받을 수 있습니다. <span class="text-gray-500">(월별 선결제건 포함)</span></li>
										<li>환불 요청 후 <strong>7일 이내</strong>로 환불 처리가 완료됩니다.</li>
									</ul>
								</div>
							</div>
							<div>
								<label class="flex items-center space-x-2 cursor-pointer p-3 bg-gray-50 rounded-lg">
									<input type="checkbox" class="agree rounded border-gray-300 text-blue-600 focus:ring-blue-500">
									<span class="text-xs text-gray-700">주문 내용 확인 및 결제 진행에 동의합니다</span>
								</label>
							</div>
						</div>
					</div>
				</div>
				<!-- Action Buttons -->
				<div class="flex space-x-4 mt-3 mb-1">
					<button type="button" onclick="fnSubmit()" class="flex-1 btn btn-outline-primary btn-lg ms-1 py-3 px-6 rounded-lg font-medium">
						<i class="fas fa-credit-card mr-2"></i>결제하기
					</button>
					<button type="button" onclick="window.history.back();" class="flex-1 btn btn-outline-danger py-3 px-6 rounded-lg font-medium">
						<i class="fas fa-times mr-2"></i>취소
					</button>
				</div>
			</form>
		</div>
		<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<h1 class="modal-title fs-5" id="staticBackdropLabel">결제하기</h1>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="wrapper">
						<div class="box_section" style="padding: 40px 30px 50px 30px; margin-top: 30px; margin-bottom: 50px">
							<!-- 결제 UI -->
							<div id="payment-method"></div>
							<!-- 이용약관 UI -->
							<div id="agreement"></div>
							<!-- 쿠폰 체크박스 -->
							<!--<div style="padding-left: 30px">
								<div class="checkable typography--p">
									<label for="coupon-box" class="checkable__label typography--regular">
										<input id="coupon-box" class="checkable__input" type="checkbox" aria-checked="true" />
										<span class="checkable__label-text">5,000원 쿠폰 적용</span>
									</label>
								</div>
							</div>-->
							<!-- 결제하기 버튼 -->
							<div class="flex space-x-4 mt-3">
								<button type="button" id="payment-button" class="flex-1 btn btn-outline-primary btn-lg ms-1 py-3 px-6 rounded-lg font-medium text-sm">
									<i class="fas fa-credit-card mr-2"></i>결제하기
								</button>
								<button type="button" data-bs-dismiss="modal" class="flex-1 btn btn-outline-danger py-3 px-6 rounded-lg font-medium text-sm">
									<i class="fas fa-times mr-2"></i>취소
								</button>
							</div>
						</div>
					</div>
				</div>
		</div>
		<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
		<script th:inline="javascript">
			
			// 우편번호 찾기 찾기 화면을 넣을 element
			var element_wrap_mo = document.getElementById('wrap3_mo');
			var element_wrap = document.getElementById('wrap3');
			var element_wrap2_mo = document.getElementById('wrap2_mo');
			var element_wrap2 = document.getElementById('wrap2');
			
			function foldDaumPostcode() {
				const vWrap = window.innerWidth >= 768 ? element_wrap : element_wrap_mo;
				// iframe을 넣은 element를 안보이게 한다.
				vWrap.style.display = 'none';
			}
			function foldDaumPostcode2() {
				const vWrap = window.innerWidth >= 768 ? element_wrap2 : element_wrap2_mo;
				// iframe을 넣은 element를 안보이게 한다.
				vWrap.style.display = 'none';
			}
			
		 	// 우편번호 찾기
			function execDaumPostcode(){
				if(typeof daum === 'undefined'){
					alert("다음 우편번호 postcode.v2.js 파일이 로드되지 않았습니다.");
					return false;
				}
		 		const vWrap = window.innerWidth >= 768 ? element_wrap : element_wrap_mo;
		 		
				// 현재 scroll 위치를 저장해놓는다.
				var currentScroll = Math.max(document.body.scrollTop, document.documentElement.scrollTop);
				new daum.Postcode({
					oncomplete: function(data) {
						// 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

						// 각 주소의 노출 규칙에 따라 주소를 조합한다.
						// 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
						var addr = ''; // 주소 변수
						var extraAddr = ''; // 참고항목 변수

						//사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
						if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
							addr = data.roadAddress;
						} else { // 사용자가 지번 주소를 선택했을 경우(J)
							addr = data.jibunAddress;
						}

						// 사용자가 선택한 주소가 도로명 타입일때 참고항목을 조합한다.
						if(data.userSelectedType === 'R'){
							// 법정동명이 있을 경우 추가한다. (법정리는 제외)
							// 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
							if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
								extraAddr += data.bname;
							}
							// 건물명이 있고, 공동주택일 경우 추가한다.
							if(data.buildingName !== '' && data.apartment === 'Y'){
								extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
							}
							// 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
							if(extraAddr !== ''){
								extraAddr = ' (' + extraAddr + ')';
							}
							// 조합된 참고항목을 해당 필드에 넣는다.
							// document.getElementById("sample3_extraAddress").value = extraAddr;
						
						} else {
							// document.getElementById("sample3_extraAddress").value = '';
						}

						// 우편번호와 주소 정보를 해당 필드에 넣는다.
						document.getElementById("o_postNum").value = data.zonecode;
						document.getElementById("o_postNum_mo").value = data.zonecode;
						document.getElementById("o_addr").value = addr;
						document.getElementById("o_addr_mo").value = addr;

						// iframe을 넣은 element를 안보이게 한다.
						// (autoClose:false 기능을 이용한다면, 아래 코드를 제거해야 화면에서 사라지지 않는다.)
						vWrap.style.display = 'none';

						// 우편번호 찾기 화면이 보이기 이전으로 scroll 위치를 되돌린다.
						document.body.scrollTop = currentScroll;
					},
					// 우편번호 찾기 화면 크기가 조정되었을때 실행할 코드를 작성하는 부분. iframe을 넣은 element의 높이값을 조정한다.
					onresize : function(size) {
						vWrap.style.height = size.height+'px';
					},
					width : '100%',
					height : '100%'
				}).embed(vWrap);

				// iframe을 넣은 element를 보이게 한다.
				vWrap.style.display = 'block';				
			}
		 	// 우편번호 찾기
			function execDaumPostcode2(){
				if(typeof daum === 'undefined'){
					alert("다음 우편번호 postcode.v2.js 파일이 로드되지 않았습니다.");
					return false;
				}
		 		const vWrap = window.innerWidth >= 768 ? element_wrap2 : element_wrap2_mo;
				// 현재 scroll 위치를 저장해놓는다.
				var currentScroll = Math.max(document.body.scrollTop, document.documentElement.scrollTop);
				new daum.Postcode({
					oncomplete: function(data) {
						// 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

						// 각 주소의 노출 규칙에 따라 주소를 조합한다.
						// 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
						var addr = ''; // 주소 변수
						var extraAddr = ''; // 참고항목 변수

						//사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
						if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
							addr = data.roadAddress;
						} else { // 사용자가 지번 주소를 선택했을 경우(J)
							addr = data.jibunAddress;
						}

						// 사용자가 선택한 주소가 도로명 타입일때 참고항목을 조합한다.
						if(data.userSelectedType === 'R'){
							// 법정동명이 있을 경우 추가한다. (법정리는 제외)
							// 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
							if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
								extraAddr += data.bname;
							}
							// 건물명이 있고, 공동주택일 경우 추가한다.
							if(data.buildingName !== '' && data.apartment === 'Y'){
								extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
							}
							// 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
							if(extraAddr !== ''){
								extraAddr = ' (' + extraAddr + ')';
							}
							// 조합된 참고항목을 해당 필드에 넣는다.
							// document.getElementById("sample3_extraAddress").value = extraAddr;
						
						} else {
							// document.getElementById("sample3_extraAddress").value = '';
						}

						// 우편번호와 주소 정보를 해당 필드에 넣는다.
						document.getElementById('r_postNum').value = data.zonecode;
						document.getElementById("r_addr").value = addr;
						document.getElementById('r_postNum_mo').value = data.zonecode;
						document.getElementById("r_addr_mo").value = addr;

						// iframe을 넣은 element를 안보이게 한다.
						// (autoClose:false 기능을 이용한다면, 아래 코드를 제거해야 화면에서 사라지지 않는다.)
						vWrap.style.display = 'none';

						// 우편번호 찾기 화면이 보이기 이전으로 scroll 위치를 되돌린다.
						document.body.scrollTop = currentScroll;
					},
					// 우편번호 찾기 화면 크기가 조정되었을때 실행할 코드를 작성하는 부분. iframe을 넣은 element의 높이값을 조정한다.
					onresize : function(size) {
						vWrap.style.height = size.height+'px';
					},
					width : '100%',
					height : '100%'
				}).embed(vWrap);

				// iframe을 넣은 element를 보이게 한다.
				vWrap.style.display = 'block';				
			}
			
			//이메일 직접입력 셀렉트박스
			function res(r){
				if(r ==""){
					$("#o_email2").attr("readonly",false);
					$("#o_email2_mo").attr("readonly",false);
				} else {
					$("#o_email2").attr("readonly",true);
					$("#o_email2_mo").attr("readonly",true);
				}
				document.getElementById("o_email2").value=r;
				document.getElementById("o_email2_mo").value=r;
			
				var email1=document.getElementById("o_email").value;
				var email2=document.getElementById("o_email2").value;
				
				document.getElementById("od_email").value=email1+"@"+email2;
			}
			//주문자와 동일
			$(".check1").on("change", function () {
				let checked = $(this).is(":checked");
			
				// 전체 체크 상태 통일
				$(".check1").prop("checked", checked);
			
				if (checked) {
					// PC 주소 복사
					$("#r_name").val($("#o_name").val());
					$("#r_tel").val($("#o_tel").val());
					$("#r_phone").val($("#o_phone").val());
					$("#r_postNum").val($("#o_postNum").val());
					$("#r_addr").val($("#o_addr").val());
					$("#r_addrDetail").val($("#o_addrDetail").val());
			
					// 모바일 주소 복사
					$("#r_name_mo").val($("#o_name_mo").val());
					$("#r_tel_mo").val($("#o_tel_mo").val());
					$("#r_phone_mo").val($("#o_phone_mo").val());
					$("#r_postNum_mo").val($("#o_postNum_mo").val());
					$("#r_addr_mo").val($("#o_addr_mo").val());
					$("#r_addrDetail_mo").val($("#o_addrDetail_mo").val());
				}
			});
			
			$(".agree").on("change", function () {
				let checked = $(this).is(":checked");
				$(".agree").prop("checked", checked);
			});
			//주문하기
			fnSubmit = function(){
				const pattern = /^[0-9|a-z|A-Z|ㄱ-ㅎ|ㅏ-ㅣ|가-힣]*$/;
				const scriptTag = /[~^&()|<>?]/;
				const emailPattern = /^[A-Za-z0-9_\.\-]+@[A-Za-z0-9\-]+\.[A-za-z0-9\-]+/;
				
				const vOrderName	= window.innerWidth >= 768 ? "o_name" : "o_name_mo";
				const vOrderPass	= window.innerWidth >= 768 ? "o_pass" : "o_pass_mo";
				const vOrderPhone	= window.innerWidth >= 768 ? "o_phone" : "o_phone_mo";
				const vOrderPostNum	= window.innerWidth >= 768 ? "o_postNum" : "o_postNum_mo";
				const vOrderAddr	= window.innerWidth >= 768 ? "o_addr" : "o_addr_mo";
				const vOrderAddrDetail	= window.innerWidth >= 768 ? "o_addrDetail" : "o_addrDetail_mo";
				const vOrderEmail	= window.innerWidth >= 768 ? "o_email" : "o_email_mo";
				const vOrderEmail2	= window.innerWidth >= 768 ? "o_email2" : "o_email2_mo";
				
				const rName			= window.innerWidth >= 768 ? "r_name" : "r_name_mo";
				const rPhone		= window.innerWidth >= 768 ? "r_phone" : "r_phone_mo";
				const rPostNum		= window.innerWidth >= 768 ? "r_postNum" : "r_postNum_mo";
				const rAddr			= window.innerWidth >= 768 ? "r_addr" : "r_addr_mo";
				const rAddrDetail	= window.innerWidth >= 768 ? "r_addrDetail" : "r_addrDetail_mo";
				
				const rRadio1		= window.innerWidth >= 768 ? "radio1" : "radio1_mo";
				const packagingFocus= window.innerWidth >= 768 ? "packagingFocus" : "packagingFocus_mo";
				
				let o_name		= $(`#${vOrderName}`).val();
				let o_pass		= $(`#${vOrderPass}`).val();
				let o_phone		= $(`#${vOrderPhone}`).val();
				let o_postNum	= $(`#${vOrderPostNum}`).val();
				let o_addr		= $(`#${vOrderAddr}`).val();
				let o_addrDetail= $(`#${vOrderAddrDetail}`).val();
				let o_email		= $(`#${vOrderEmail}`).val();
				let o_email2	= $(`#${vOrderEmail2}`).val();
				
				let delivKind	= $('input[name=delivKind]').is(":checked");
				let packaging	= $('input[name=packaging]').is(":checked");
				let r_name		= $(`#${rName}`).val();
				let r_phone		= $(`#${rPhone}`).val();
				let r_postNum	= $(`#${rPostNum}`).val();
				let r_addr		= $(`#${rAddr}`).val();
				let r_addrDetail= $(`#${rAddrDetail}`).val();
				
				if(o_name.replaceAll(" ", "") == ""){
					alert("주문하시는 분 이름을 입력해 주세요.");
					setTimeout( function(){ $("#"+vOrderName).focus(); }, 1 );
					return;
				} else if(!pattern.test(o_name) == true){
					alert("공백 혹은 특수문자가 입력되었습니다.");
					setTimeout( function(){ $("#"+vOrderName).focus(); }, 1 );
					return;
				}
				if(o_pass.replaceAll(" ", "") == ""){
					alert("비밀번호를 입력해 주세요.");
					setTimeout( function(){ $("#"+vOrderPass).focus(); }, 1 );
					return;
				} else if(!pattern.test(o_pass) == true){
					alert("공백 혹은 특수문자가 입력되었습니다.");
					setTimeout( function(){ $("#"+vOrderPass).focus(); }, 1 );
					return;
				} else if(o_pass.length < 3){
					alert("세 자리 이상 입력해 주세요.");
					setTimeout( function(){ $("#"+vOrderPass).focus(); }, 1 );
					return;
				}
				if(o_phone.replaceAll(" ", "") == ""){
					alert("핸드폰번호를 입력해 주세요.");
					setTimeout( function(){ $("#"+vOrderPhone).focus(); }, 1 );
					return;
				}
				if(o_postNum.replaceAll(" ", "") == ""){
					alert("주소 검색을 해주세요.");
					setTimeout( function(){ $("#"+vOrderPostNum).focus(); }, 1 );
					return;
				} else if(!pattern.test(o_postNum) == true){
					alert("공백 혹은 특수문자가 입력되었습니다.");
					setTimeout( function(){ $("#"+vOrderPostNum).focus(); }, 1 );
					return;
				}
				if(o_addr.replaceAll(" ", "") == ""){
					alert("주소 검색을 해주세요.");
					setTimeout( function(){ $("#"+vOrderAddr).focus(); }, 1 );
					return;
				}
				if(o_addrDetail.replaceAll(" ", "") == ""){
					alert("상세 주소를 입력해 주세요.");
					setTimeout( function(){ $("#"+vOrderAddrDetail).focus(); }, 1 );
					return;
				}
				if(o_email.replaceAll(" ", "") == ""){
					alert("이메일을 입력해 주세요.");
					setTimeout( function(){ $("#"+vOrderEmail).focus(); }, 1 );
					return;
				} else if(o_email2.replaceAll(" ", "") == ""){
					alert("이메일을 입력해 주세요.");
					setTimeout( function(){ $("#"+vOrderEmail2).focus(); }, 1 );
					return;
				}
				
				$("#od_email").val(o_email+"@"+o_email2);
				
				if(r_name.replaceAll(" ", "") == ""){
					alert("받으시는 분 이름을 입력해 주세요.");
					setTimeout( function(){ $("#"+rName).focus(); }, 1 );
					return;
				} else if(!pattern.test(r_name) == true){
					alert("공백 혹은 특수문자가 입력되었습니다.");
					setTimeout( function(){ $("#"+rName).focus(); }, 1 );
					return;
				}
				if(r_phone.replaceAll(" ", "") == ""){
					alert("핸드폰번호를 입력해 주세요.");
					setTimeout( function(){ $("#"+rPhone).focus(); }, 1 );
					return;
				}
				if(r_postNum.replaceAll(" ", "") == ""){
					alert("주소 검색을 해주세요.");
					setTimeout( function(){ $("#"+rPostNum).focus(); }, 1 );
					return;
				} else if(!pattern.test(r_postNum) == true){
					alert("공백 혹은 특수문자가 입력되었습니다.");
					setTimeout( function(){ $("#"+rPostNum).focus(); }, 1 );
					return;
				}
				if(r_addr.replaceAll(" ", "") == ""){
					alert("주소 검색을 해주세요.");
					setTimeout( function(){ $("#"+rAddr).focus(); }, 1 );
					return;
				}
				if(r_addrDetail.replaceAll(" ", "") == ""){
					alert("상세 주소를 입력해 주세요.");
					setTimeout( function(){ $("#"+rAddrDetail).focus(); }, 1 );
					return;
				}
				if(!delivKind){
					alert("배송 유형을 선택해 주세요.");
					setTimeout( function(){ $("#"+rRadio1).focus(); }, 1 );
					return;
				}
				if(!packaging){
					alert("포장가방을 선택해 주세요.");
					setTimeout( function(){ $("#"+packagingFocus).get(0).scrollIntoView(); }, 1 );
					return;
				}
				if(!$(".agree").is(":checked")){
					alert("결제정보 확인 및 구매진행에 동의하셔야 주문이 가능합니다.");
					return;
				}
				const formId = window.innerWidth >= 768 ? "pc_form" : "mo_form";
				let orderVO = $("#" + formId).serializeObject();
				orderVO.orderNo = /*[[${orderNo}]]*/""; 
				
				$.ajax({
					url: "/rest/order/orderPayment",
					type: "POST",
					dataType: "json",
					data: 	orderVO,
					success: function (result) {
						if(result.responseCode == "SUCCESS"){
							if(result.data.resultCode == "SUCCESS"){
												
								var orderId = /*[[${orderNo}]]*/"";
								var amount = {
									currency: "KRW",
									value: result.data.TOTAL_AMOUNT,
								};
								// 비회원 결제
								// 스크립트 태그 연동방식
								let order = /*[[${order.productList}]]*/"";
								let orderSize = order.length;
								let orderName = "밥수니반찬세트";
								if(orderSize > 1){
									orderName = order[0].menuDay + " 외 " + Number(orderSize-1) +" 건"
								} else if(orderSize == 1){
									orderName = order[0].menuDay
								}
								payments(amount,orderId,orderName);
								$("#modalPay").trigger("click");
							} else {
								alert(result.data.resultMsg);
								if(result.data.returnUrl != ""){
									location.href = result.data.returnUrl;
								}
							}
						} else {
							alert("관리자에게 문의 부탁드립니다.");
						}
					},
					error: function (e) {
						alert("장바구니 리스트 삭제에 실패했습니다.");
					}
				});
			}
			
			$(document).on("keyup", ".phoneNumber", function() { 
				$(this).val( $(this).val().replace(/[^0-9]/g, "").replace(/(^02|^0505|^1[0-9]{3}|^0[0-9]{2})([0-9]+)?([0-9]{4})$/,"$1-$2-$3").replace("--", "-") ); 
			});
			
			document.querySelectorAll('.packaging-option').forEach(option => {
				option.addEventListener('click', () => {
					const dataBindValue = option.getAttribute('data-bind');
					if (!dataBindValue) return;
			
					// 1) 모든 .packaging-option에서 선택 클래스 제거
					document.querySelectorAll('.packaging-option').forEach(opt => opt.classList.remove('selected'));
			
					// 2) 같은 data-bind 값을 가진 .packaging-option 모두에 selected 클래스 붙이기 (PC/모바일 동기화)
					document.querySelectorAll(`.packaging-option[data-bind="${dataBindValue}"]`).forEach(opt => opt.classList.add('selected'));
			
					// 3) 같은 data-bind 값을 가진 라디오 모두 체크하기
					document.querySelectorAll(`.packaging-option[data-bind="${dataBindValue}"] input[type="radio"]`).forEach(radio => radio.checked = true);
			
					const firstRadio = document.querySelector(`.packaging-option[data-bind="${dataBindValue}"] input[type="radio"]`);
					if (firstRadio) {
						firstRadio.dispatchEvent(new Event("change"));
					}
				});
			});
			$(document).ready(function() {
				$('[data-bs-toggle="tooltip"]').tooltip();
				
				$("input:radio[name='packaging']").on("change", function(){
					let deposit = 0;
					if ($(this).val() == "1000"){
						let innerHTML = "";
						innerHTML += '<tr id="depositTr">';
						innerHTML += `<td colspan="2"></td>`;
						innerHTML += `<td class='px-4 py-4 text-right'>보냉가방(보증금)</td>`;
						innerHTML += "<td class='px-4 py-4 text-right text-red-600 font-bold'><span id='deposit'>5,000</span></td>";
						innerHTML += '</tr>';
						
						let innerMoHTML = "";
						innerMoHTML +=`<div class="bg-gray-50 p-4 rounded-lg" id="depositMo">`;
						innerMoHTML	+=	`<div class="flex justify-between items-center">`;
						innerMoHTML +=		`<span class="text-sm">보냉가방(보증금)</span>`;
						innerMoHTML +=		`<span id="deposit_mo" class="text-sm font-bold text-red-600">5,000</span>`;
						innerMoHTML +=	`</div>`;
						innerMoHTML +=`</div>`;
						
						$('#delivDiv').after(innerMoHTML);
						$('#myTable > tbody > tr:last').after(innerHTML);
						deposit = 5000;
					} else {
						$("#depositTr").remove();
						$("#depositMo").remove();
					}
					let delivAmount = Number($("#delivAmount").text().replaceAll(",","").replaceAll("무료",0));
					let totalAmount = 0;
					$(".subAmount").each(function (index, item){
						totalAmount += Number($(item).text().replaceAll(",","").replaceAll("원",""));
					});
					totalAmount += delivAmount + deposit;
					$("#totalAmount").text(totalAmount.toLocaleString('ko-KR')+"원");
					$("#totalAmount_mo").text(totalAmount.toLocaleString('ko-KR')+"원");
				});
				
				$("input:radio[name='delivKind']").on("change", function(){
					// 선택된 radio의 값
					let selectedValue = $(this).val();
					// 해당 value를 가진 radio를 체크 상태로 설정
					$("input:radio[name='delivKind'][value='" + selectedValue + "']").prop("checked", true);
					
					let delivAmount = 0;		//배송비
					let orderQty = 0;			//총수량
					let totalAmount = 0;		//총금액
					let deposit = 0;			//보증금
					// 라디오 버튼 변경 클릭 시 이벤트 삽입
					if ($(this).val() == "1000"){
						
						$(".orderQty").each(function (index, item){
							orderQty += Number($(item).text());
						});
						if(orderQty < 3){
							$("#delivAmount").text("2,000");
							$("#delivAmount_mo").text("2,000");
							delivAmount = 2000;
						} else {
							$("#delivAmount").text("무료");
							$("#delivAmount_mo").text("무료");
						}
					} else if($(this).val() == "2000"){
						$("#delivAmount").text("4,000");
						$("#delivAmount_mo").text("4,000");
						delivAmount = Number($("#delivAmount").text().replaceAll(",",""));
					}
					$(".subAmount").each(function (index, item){		//소계
						totalAmount += Number($(item).text().replaceAll(",",""));
					});
					if($("#deposit").text() != ""){
						deposit = Number($("#deposit").text().replaceAll(",","").replaceAll("원",""));
					}
					totalAmount += delivAmount + deposit;
					$("#totalAmount").text(totalAmount.toLocaleString('ko-KR')+"원");
					$("#totalAmount_mo").text(totalAmount.toLocaleString('ko-KR')+"원");
				});
				
			});
			let isMobile = window.innerWidth < 768;
			window.addEventListener("resize", function() {
				const nowMobile = window.innerWidth < 768;

				// PC → 모바일 또는 모바일 → PC 전환 시에만 실행
				if (nowMobile !== isMobile) {
					isMobile = nowMobile;
			
					syncFormValues();
				}
			});
			
			function syncFormValues() {
				// PC → MO 또는 MO → PC로 복사
				const sourceForm = isMobile ? '#pc_form' : '#mo_form';
				const targetForm = isMobile ? '#mo_form' : '#pc_form';
			
				// sourceForm의 모든 input 값을 targetForm으로 복사
				$(sourceForm).find('input, select, textarea').each(function () {
					const name = $(this).attr('name');
					const type = $(this).attr('type');
					const value = $(this).val();
			
					if (!name) return;
			
					if (type === 'radio') {
						// 체크된 라디오만 처리
						if ($(this).is(':checked')) {
							// 동일 name, 동일 value 가진 라디오를 체크 상태로
							$(targetForm).find('input[type="radio"][name="' + name + '"][value="' + value + '"]').prop('checked', true);
						}
					} else {
						// 일반 input/select/textarea는 value만 복사
						$(targetForm).find('[name="' + name + '"]').val(value);
					}
				});
			}
		</script>
	</main>
</html>