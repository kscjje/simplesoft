<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>이김청년부 깜짝퀴즈</title>
	<link rel="stylesheet" href="/css/tailwind.min.css" />
	<link rel="stylesheet" href="/css/all.min.css" />
	<style>
		body {
			font-family: 'Nanum Gothic', sans-serif;
			background: #0f172a; /* 진한 남색 배경 */
			color: #e0e7ff; /* 밝은 글씨 */
			min-height: 100vh;
			display: flex;
			flex-direction: column;
			align-items: center;
			padding: 2rem 1rem;
		}
		h2 {
			font-weight: 900;
			color: #38bdf8; /* 시안 색감 */
			text-shadow: 0 0 6px #0ea5e9;
			margin-bottom: 2rem;
			user-select: none;
			text-align: center;
		}
		#quiz-box {
			background: #1e293b;
			border: 2px solid #38bdf8;
			border-radius: 1rem;
			padding: 2rem 3rem;
			width: 90vw;
			max-width: 700px;
			box-shadow: 0 0 20px #38bdf8aa;
			margin-bottom: 3rem;
			text-align: center;
		}
		#quiz-box h2 {
			font-size: 1.75rem;
			margin-bottom: 1rem;
			font-weight: 700;
			color: #60a5fa;
		}
		#quiz-box p {
			font-size: 1.3rem;
			color: #cbd5e1;
			line-height: 1.5;
			user-select: text;
			word-break: keep-all;
		}
		.btn {
			background-color: #0ea5e9;
			color: #fff;
			font-weight: 700;
			padding: 0.75rem 2rem;
			border-radius: 0.75rem;
			transition: background-color 0.3s ease;
			user-select: none;
			min-width: 100px;
			font-size: 1rem;
		}
		.btn:hover {
			background-color: #0284c7;
		}
		.flex.space-x-2 {
			margin-bottom: 2rem;
			flex-wrap: wrap;
			justify-content: center;
			gap: 0.75rem;
		}
		table {
			border-collapse: collapse;
			width: 90vw;
			max-width: 1000px;
			border-radius: 0.5rem;
			overflow: auto;
			box-shadow: 0 0 15px #38bdf8aa;
			display: block;
			-webkit-overflow-scrolling: touch; /* 부드러운 터치 스크롤 */
		}
		th, td {
			padding: 0.75rem 1rem;
			border: 1px solid #3b82f6;
			text-align: center;
			font-size: 0.9rem;
			white-space: nowrap;
		}
		thead {
			background-color: #0ea5e9;
			color: white;
		}
		tbody tr:hover {
			background-color: #2563eb80;
			cursor: pointer;
		}
		/* 모달 디자인 */
		.modal-content {
			background: #1e293b;
			border: 2px solid #38bdf8;
			border-radius: 1rem;
			padding: 2rem 2.5rem;
			width: 90vw;
			max-width: 450px;
			color: #cbd5e1;
			box-shadow: 0 0 20px #38bdf8aa;
			position: relative;
		}
		#start-modal, #change-modal {
			background: rgba(15, 23, 42, 0.9);
			position: fixed;
			top: 0; left: 0; right: 0; bottom: 0;
			display: flex;
			align-items: center;
			justify-content: center;
			z-index: 9999;
			padding: 1rem;
		}
		#start-modal[style*="display: none"], #change-modal[style*="display: none"] {
			display: none !important;
		}
		#start-modal button, #change-modal button {
			user-select: none;
		}
		/* 닫기 버튼 */
		.modal-content button#close-modal,
		.modal-content button#close-modal2 {
			position: absolute;
			top: 1rem;
			right: 1rem;
			background: transparent;
			color: #f472b6;
			font-size: 1.75rem;
			font-weight: 900;
			border: none;
			cursor: pointer;
			transition: color 0.2s ease;
		}
		.modal-content button#close-modal:hover,
		.modal-content button#close-modal2:hover {
			color: #f9a8d4;
		}
		input[type="text"] {
			width: 100%;
			padding: 0.75rem 1rem;
			border-radius: 0.5rem;
			border: none;
			outline: none;
			font-size: 1rem;
			color: #0f172a;
		}
		input[type="text"]:focus {
			box-shadow: 0 0 8px #38bdf8;
		}

		/* 반응형 폰트 크기 조절 */
		@media (max-width: 640px) {
			h1 {
				font-size: 2rem;
			}
			#quiz-box h2 {
				font-size: 1.4rem;
			}
			#quiz-box p {
				font-size: 1.1rem;
			}
			.btn {
				font-size: 0.9rem;
				padding: 0.6rem 1.5rem;
			}
			th, td {
				font-size: 0.8rem;
				padding: 0.5rem 0.75rem;
			}
			.modal-content {
				padding: 1.5rem 2rem;
			}
		}
	</style>
</head>
<body>
	<h2>이김 청년부 수련회 깜짝 퀴즈</h2>

	<!-- 퀴즈 문제 영역 -->
	<div id="quiz-box" aria-live="polite" role="region" aria-label="퀴즈 문제">
		<h2>퀴즈 문제</h2>
		<p id="quiz-question">퀴즈가 여기에 표시됩니다. 문제를 풀어보세요!</p>
	</div>

	<div class="flex space-x-2">
		<button type="button" class="btn" id="idInsert">정답</button>
	</div>

	<!-- 모달 HTML -->
	<div id="start-modal" style="display: none;">
		<div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="start-modal-title">
			<button type="button" id="close-modal" aria-label="모달 닫기">×</button>
			<h2 id="start-modal-title" class="text-cyan-300 text-2xl font-bold mb-6">정답을 입력해주세요.</h2>
			<input type="text" id="userName" aria-describedby="start-modal-desc" placeholder="정답 작성" onkeydown="enterKey()" />
			<button type="button" id="start-yes" class="btn mt-4 w-full">등록</button>
		</div>
	</div>

	<script src="/js/common/jquery-3.6.0.min.js"></script>
	<script th:inline="javascript">
		document.getElementById('idInsert').addEventListener('click', () => {
			$("#userName").val("");
			$("#start-modal").show();
			$("#userName").focus();
		});
		const btnYes = document.getElementById('start-yes');
		
		btnYes.addEventListener('click', () => {
			saveStartTimeToServer();
		});
		
		function saveStartTimeToServer() {
			let userName = $("#userName").val();
			if(userName == ""){
				alert("정답을 입력해 주세요.");
				return;
			}
			$.ajax({
				url: '/insert',
				type: 'POST',
				data: {
					userName: userName
				},
				dataType: 'json',
				success: function (res) {
					if(res.data.RET_CODE == "DUPLE"){
						alert("이미 등록된 사용자입니다.");
						return;
					} else {
						location.reload();
					}
				},
				error: function () {
					alert('시작 시간 저장 실패');
				}
			});
		}

		function changeUser() {
			let userName = $("#userName2").val();
			if(userName == ""){
				alert("사용자를 입력해 주세요.");
				return;
			}
			$.ajax({
				url: '/change',
				type: 'POST',
				data: {
					userName: userName
				},
				dataType: 'json',
				success: function (res) {
					if(res.data.RET_CODE == "NOT"){
						alert("등록된 사용자가 없습니다.");
						return;
					} else {
						location.href = "/";
					}
				},
				error: function () {
					alert('서버 오류가 발생했습니다.');
				}
			});
		}

		enterKey = function(){
			if (window.event.keyCode == 13) {
				$('#start-yes').trigger("click");
			}
		}
		enterKey2 = function(){
			if (window.event.keyCode == 13) {
				$('#change-yes').trigger("click");
			}
		}
		$('#close-modal').on('click', function () {
			$('#start-modal').hide();
		});

		const quizQuestions = [
			"이김 청년부 방탈출 깜짝퀴즈에 오신 걸 환영합니다!",
			"첫 번째 문제: 성경에서 모세가 두 번 반석을 친 이유는 무엇일까요?",
			"두 번째 문제: '이김'의 뜻은 무엇일까요?",
			"마지막 문제: 퀴즈가 끝났습니다! 모두 수고하셨습니다."
		];
		let currentQuizIndex = 0;
		const quizQuestionElem = document.getElementById('quiz-question');

		function showNextQuiz() {
			currentQuizIndex++;
			if(currentQuizIndex >= quizQuestions.length) currentQuizIndex = 0;
			quizQuestionElem.textContent = quizQuestions[currentQuizIndex];
		}
		 /*<![CDATA[*/
	    const check = /*[[${check}]]*/ [];
	    /*]]>*/
		if(check === "Y"){
			setInterval(showNextQuiz, 10000);
		} else {
			alert("잘못된 접근입니다.");
			location.href="https://www.naver.com";
		}
	</script>
</body>
</html>
