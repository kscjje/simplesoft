<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.simplesoft.mapper.room.RoomMapper">

	<!-- 결제정보 생성 -->
	<insert id="insertRoom" parameterType="hashMap">
		/* RoomMapper.insertRoom */
		INSERT INTO ROOM
			(
					USER_NAME
				,	REG_DT
			)
		VALUES(
					#{userName}
				,	NOW()
		) ON DUPLICATE KEY
		UPDATE USER_NAME = #{userName}
	</insert>
	
	<select id="selectRoomDetail" parameterType="hashMap" resultType="CamelHashMap">
		/* RoomMapper.selectRoomDetail */
		SELECT
			  *
		FROM ROOM A
		WHERE 1=1
		AND A.USER_NAME = #{userName}
	</select>
	
	<update id="updateRoom" parameterType="hashMap">
		/* RoomMapper.updateRoom */
		UPDATE ROOM SET
		<if test="type == '01'">
			HINT1 = 'Y'
		</if>
		<if test="type == '02'">
			HINT2 = 'Y'
		</if>
		<if test="type == '03'">
			HINT3 = 'Y'
		</if>
		<if test="type == '04'">
			HINT4 = 'Y'
		</if>
		<if test="type == '05'">
			HINT5 = 'Y'
		</if>
		<if test="type == '06'">
			HINT6 = 'Y'
		</if>
		<if test="suc eq '01'">
			SUC_DT = NOW()
		</if>
		WHERE USER_NAME = #{userName}
	</update>
	
	<select id="list" resultType="CamelHashMap">
		/* RoomMapper.list */
		SELECT 
			USER_NAME
			,(CASE
				WHEN HINT1 = 'Y' THEN '사용'
				ELSE '미사용' 
			END) AS HINT1
			,(CASE
				WHEN HINT2 = 'Y' THEN '사용'
				ELSE '미사용' 
			END) AS HINT2
			,(CASE
				WHEN HINT3 = 'Y' THEN '사용'
				ELSE '미사용' 
			END) AS HINT3
			,(CASE
				WHEN HINT4 = 'Y' THEN '사용'
				ELSE '미사용' 
			END) AS HINT4
			,(CASE
				WHEN HINT5 = 'Y' THEN '사용'
				ELSE '미사용' 
			END) AS HINT5
			,(CASE
				WHEN HINT6 = 'Y' THEN '사용'
				ELSE '미사용' 
			END) AS HINT6
			,DATE_FORMAT(REG_DT,'%Y-%m-%d %T') AS REG_DT
			,DATE_FORMAT(SUC_DT,'%Y-%m-%d %T') AS SUC_DT
			,(CASE
				WHEN TIMEDIFF(DATE_ADD(REG_DT, INTERVAL 15 MINUTE), SUC_DT) >= 0 THEN '성공'
				ELSE '탈출 실패'
			END) AS SUC_YN
			,TIMEDIFF(SUC_DT ,REG_DT) RESULT_TIME
		FROM ROOM
		WHERE 1=1
		ORDER BY TIMEDIFF(SUC_DT ,REG_DT) IS NULL ASC, TIMEDIFF(SUC_DT ,REG_DT) ASC
	</select>
</mapper>