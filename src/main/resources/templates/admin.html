<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8" />
	<title>ì´ê¹€ì²­ë…„ë¶€ ë°©íƒˆì¶œ</title>
	<link rel="stylesheet" href="/css/tailwind.min.css">
	<link rel="stylesheet" href="/css/all.min.css">
	<link rel="stylesheet" href="/css/room.css">
	<script src="/js/common/jquery-3.6.0.min.js"></script>
	<style>
		body{
			font-family: 'Nanum Gothic', sans-serif;
		}
	</style>
</head>
<body>
	<h1>ğŸ” Escape Room Timer</h1>
	
	<button type="button" class="btn mt-5" id="idInsert">ì‚¬ìš©ì ë“±ë¡</button>
	
	<!-- ë“±ë¡ëœ ì‚¬ìš©ì ë¦¬ìŠ¤íŠ¸ -->
	<div class="mt-12">
		<h2 class="text-xl font-bold mb-4 text-cyan-300">ğŸ§‘ ì‚¬ìš©ì ëª©ë¡</h2>
		<div class="overflow-x-auto">
			<table class="min-w-full bg-gray-800 border border-cyan-500">
				<thead class="bg-gray-700 ">
					<tr>
						<th class="px-4 py-2 border border-cyan-500">ë²ˆí˜¸</th>
						<th class="px-4 py-2 border border-cyan-500">ì‚¬ìš©ìëª…</th>
						<th class="px-4 py-2 border border-cyan-500">ì‹œì‘ì‹œê°„</th>
						<th class="px-4 py-2 border border-cyan-500">ì„±ê³µì‹œê°„</th>
						<th class="px-4 py-2 border border-cyan-500">ê±¸ë¦°ì‹œê°„</th>
						<th class="px-4 py-2 border border-cyan-500">íŒíŠ¸ 1</th>
						<th class="px-4 py-2 border border-cyan-500">íŒíŠ¸ 2</th>
						<th class="px-4 py-2 border border-cyan-500">íŒíŠ¸ 3</th>
						<th class="px-4 py-2 border border-cyan-500">íŒíŠ¸ 4</th>
						<th class="px-4 py-2 border border-cyan-500">íŒíŠ¸ 5</th>
						<th class="px-4 py-2 border border-cyan-500">íŒíŠ¸ 6</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="item, stat : ${list}" class="hover:bg-gray-700">
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${stat.count}">1</td>
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${item.userName}"></td>
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${item.regDt}"></td>
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${item.sucDt}"></td>
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${item.timeToSuccess}"></td>
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${item.hint1}">Y</td>
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${item.hint2}">N</td>
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${item.hint3}">Y</td>
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${item.hint4}">N</td>
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${item.hint5}">Y</td>
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${item.hint6}">N</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	
	<!-- ì‹œì‘ ëª¨ë‹¬ -->
	<div id="start-modal" style="display:none;">
		<div class="modal-content">
			<h2>ì‚¬ìš©ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</h2>
			<input type="text" id="userName" class="px-3 py-2 border border-gray-300 rounded-md input-focus" onkeypress="enterKey()">
			<button id="start-yes">ë“±ë¡</button>
		</div>
	</div>
	<script>
		document.getElementById('idInsert').addEventListener('click', () => {
			$("#userName").val("");
			$("#start-modal").show();
		});
		const btnYes = document.getElementById('start-yes');
		
		btnYes.addEventListener('click', () => {
			saveStartTimeToServer();
		});
		// ì‹œì‘ ì‹œê°„ ì„œë²„ ì €ì¥ (POST)
		function saveStartTimeToServer() {
			let userName = $("#userName").val();
			if(userName == ""){
				alert("ì‚¬ìš©ìë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
				return;
			}
			$.ajax({
				url: '/insert',
				type: 'POST',
				data: {
					userName	: userName
				},
				dataType: 'json',
				success: function (res) {
					if(res.data.RET_CODE == "DUPLE"){
						alert("ì´ë¯¸ ë“±ë¡ëœ ì‚¬ìš©ìì…ë‹ˆë‹¤.");
						return;
					} else {
						$("#start-modal").hide();
						alert("ë“±ë¡ ë˜ì—ˆìŠµë‹ˆë‹¤.");
					}
				},
				error: function () {
					console.error('ì‹œì‘ ì‹œê°„ ì €ì¥ ì‹¤íŒ¨');
				}
			});
		}

		// ì‹œì‘ ì‹œê°„ ì„œë²„ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸° (GET)
		function loadStartTimeFromServer(callback) {
			$.ajax({
				url: '/load',
				type: 'GET',
				dataType: 'json',
				success: function (res) {
					if (res && res.data && res.data.regDt) {
						callback(res.data.regDt);
					} else {
						callback(null);
					}
				},
				error: function () {
					console.error('íƒ€ì´ë¨¸ ì‹œì‘ ì‹œê°„ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
					callback(null);
				}
			});
		}
		enterKey = function(type){
			if (window.event.keyCode == 13) {
				$('#start-yes').trigger("click");
			}
		}
	</script>
</body>
</html>
