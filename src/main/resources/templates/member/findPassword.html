<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
		xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
		layout:decorate="~{layouts/mypage_layout}">
		<main class="content-wrapper" layout:fragment="content" >
			<style>
				.content-container {
					max-width: 600px;
					min-height: 561px;
					margin: 0 auto;
				}
			</style>
			<div class="content-container justify-content-center text-center">
				<div class="rounded-lg p-8 overflow-y-auto leading-relaxed mb-5 bg-white shadow-lg max-w-xl mx-auto">
					<h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">
						비밀번호 찾기
					</h1>
					<!-- 이름 -->
					<div class="mb-4">
						<label for="userNm" class="block mb-2 text-lg font-semibold text-gray-700 text-start">이름</label>
						<input type="text" name="userNm" id="userNm" placeholder="이름을 입력해 주세요." maxlength="10" onkeypress="enterKey()"
							class="w-full px-4 py-3 border border-gray-300 text-lg rounded focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent">
					</div>
			
					<!-- 이메일 -->
					<div class="mb-4">
						<label for="userEmail" class="block mb-2 text-lg font-semibold text-gray-700 text-start">이메일</label>
						<input type="text" name="userEmail" id="userEmail" placeholder="이메일을 입력해 주세요." maxlength="20" onkeypress="enterKey()"
							class="w-full px-4 py-3 border border-gray-300 text-lg rounded focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent">
					</div>
			
					<div class="flex space-x-4">
						<button type="button" onclick="location.href='/login'" class="w-1/2 py-3 text-lg font-bold text-gray-700 bg-gray-200 rounded-xl hover:bg-gray-300 transition">
							이전
						</button>
						<button type="button" onclick="fnFindPassword()" class="w-1/2 py-3 text-lg font-bold text-white bg-black rounded-xl hover:bg-blue-700 transition">
							확인
						</button>
					</div>
					<div class="alert alert-primary mt-5" role="alert">
						<span class="small">회원가입 시 등록한 정보로 비밀번호를 찾을 수 있습니다.</span>
					</div>
				</div>
				<form id="formSend" action="/findPasswordResult" method="post">
					<input type="hidden" name="userId" id="userId">
					<input type="hidden" name="userEmail" id="userEmail">
				</form>
			</div>
		
			<script th:inline="javascript">
				$(document).on("keyup", ".phoneNumber", function() { 
					$(this).val( $(this).val().replace(/[^0-9]/g, "").replace(/(^02|^0505|^1[0-9]{3}|^0[0-9]{2})([0-9]+)?([0-9]{4})$/,"$1-$2-$3").replace("--", "-") ); 
				});
				//비밀번호찾기
				fnFindPassword = function(){
					let userNm = $('#userNm').val().trim();
					let userEmail = $('#userEmail').val().trim();
					
					if(userNm == ""){
						alert("이름을 입력해 주세요.");
						$('#userNm').focus();
						return;
					} else if(userEmail == ""){
						alert("이메일을 입력해 주세요.")
						$('#userEmail').focus();
						return;
					}
					let loginInfo = {
						userNm : userNm,
						userEmail : userEmail
					}
					$.ajax({
						url : "/rest/member/findPasswordAjax",
						type : "POST",
						dataType : "json",
						data : loginInfo,
						success : function(data) {
							if(data.data?.userId != null){
								$("#userId").val(data.data.userId);
								$("#userEmail").val(data.data.userEmail);
								$("#formSend").submit();
							} else{
								alert("등록된 회원이 없습니다.");
							}
						}, error : function(request, status, error) {
							alert("관리자에게 문의해 주세요.");
						}
					});
				}
				enterKey = function(type){
					if (window.event.keyCode == 13) {
						fnFindPassword();
					}
				}
			</script>
		</main>
</html>