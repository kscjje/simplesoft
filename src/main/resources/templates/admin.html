<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8" />
	<title>ì´ê¹€ì²­ë…„ë¶€ ë°©íƒˆì¶œ</title>
	<link rel="stylesheet" href="/css/tailwind.min.css">
	<link rel="stylesheet" href="/css/all.min.css">
	<link rel="stylesheet" href="/css/room.css">
	<script src="/js/common/jquery-3.6.0.min.js"></script>
	<style>
		body{
			font-family: 'Nanum Gothic', sans-serif;
		}
		#start-modal .modal-content {
			padding : 45px 115px;
		}
		#change-modal .modal-content {
			padding : 45px 115px;
		}
	</style>
</head>
<body>
	<h1>ğŸ” Escape Room Timer</h1>
	
	<div class="flex space-x-2 mt-5">
		<button type="button" class="btn mt-5" id="idInsert">ì‚¬ìš©ì ë“±ë¡</button>
		<button type="button" class="btn mt-5" id="idChagne">ì‚¬ìš©ì ì „í™˜</button>
	</div>
	
	<!-- ë“±ë¡ëœ ì‚¬ìš©ì ë¦¬ìŠ¤íŠ¸ -->
	<div class="mt-12">
		<h2 class="text-xl font-bold mb-4 text-cyan-300">ğŸ§‘ ì‚¬ìš©ì ëª©ë¡</h2>
		<div class="overflow-x-auto">
			<table class="min-w-full bg-gray-800 border border-cyan-500">
				<thead class="bg-gray-700 ">
					<tr>
						<th class="px-4 py-2 border border-cyan-500">ë²ˆí˜¸</th>
						<th class="px-4 py-2 border border-cyan-500">ì‚¬ìš©ìëª…</th>
						<th class="px-4 py-2 border border-cyan-500">ì‹œì‘ì‹œê°„</th>
						<th class="px-4 py-2 border border-cyan-500">ì„±ê³µì‹œê°„</th>
						<th class="px-4 py-2 border border-cyan-500">ê±¸ë¦°ì‹œê°„</th>
						<th class="px-4 py-2 border border-cyan-500">íŒíŠ¸ 1</th>
						<th class="px-4 py-2 border border-cyan-500">íŒíŠ¸ 2</th>
						<th class="px-4 py-2 border border-cyan-500">íŒíŠ¸ 3</th>
						<th class="px-4 py-2 border border-cyan-500">íŒíŠ¸ 4</th>
						<th class="px-4 py-2 border border-cyan-500">íŒíŠ¸ 5</th>
						<th class="px-4 py-2 border border-cyan-500">íŒíŠ¸ 6</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="item, stat : ${list}" class="hover:bg-gray-700">
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${stat.count}">1</td>
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${item.userName}"></td>
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${item.regDt}"></td>
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${item.sucDt}"></td>
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${item.timeToSuccess}"></td>
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${item.hint1}">Y</td>
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${item.hint2}">N</td>
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${item.hint3}">Y</td>
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${item.hint4}">N</td>
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${item.hint5}">Y</td>
						<td class="px-4 py-2 border border-cyan-500 text-center" th:text="${item.hint6}">N</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	
	<!-- ëª¨ë‹¬ HTML -->
	<div id="start-modal" style="display: none;">
		<div class="modal-content relative p-8 rounded-xl bg-black border-2 border-cyan-400 shadow-xl text-center">
			<!-- ë‹«ê¸° ë²„íŠ¼ -->
			<button type="button" id="close-modal" class="absolute top-4 right-4 text-pink-400 text-xl font-bold hover:text-white transition duration-200">Ã—</button>
			<h2 class="text-cyan-300 text-2xl font-bold mb-6">ì‚¬ìš©ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</h2>
			
			<input type="text" id="userName" class="w-full px-4 py-3 mb-6 border border-gray-300 rounded-md text-black text-lg focus:outline-none focus:ring-2 focus:ring-cyan-400" onkeypress="enterKey()">
			
			<button type="button" id="start-yes" class="px-6 py-2 bg-black border-2 border-pink-500 text-pink-400 font-bold rounded-lg hover:bg-pink-500 hover:text-white transition duration-200">
				ë“±ë¡
			</button>
		</div>
	</div>
	<!-- ëª¨ë‹¬ HTML -->
	<div id="change-modal" style="display: none;">
		<div class="modal-content relative p-8 rounded-xl bg-black border-2 border-cyan-400 shadow-xl text-center">
			<!-- ë‹«ê¸° ë²„íŠ¼ -->
			<button type="button" id="close-modal2" class="absolute top-4 right-4 text-pink-400 text-xl font-bold hover:text-white transition duration-200">Ã—</button>
			<h2 class="text-cyan-300 text-2xl font-bold mb-6">ì‚¬ìš©ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</h2>
			
			<input type="text" id="userName2" class="w-full px-4 py-3 mb-6 border border-gray-300 rounded-md text-black text-lg focus:outline-none focus:ring-2 focus:ring-cyan-400" onkeypress="enterKey2()">
			
			<button type="button" id="change-yes" class="px-6 py-2 bg-black border-2 border-pink-500 text-pink-400 font-bold rounded-lg hover:bg-pink-500 hover:text-white transition duration-200">
				ì „í™˜
			</button>
		</div>
	</div>

	<script>
		document.getElementById('idInsert').addEventListener('click', () => {
			$("#userName").val("");
			$("#start-modal").show();
			$("#userName").focus();
		});
		document.getElementById('idChagne').addEventListener('click', () => {
			$("#userName2").val("");
			$("#change-modal").show();
			$("#userName2").focus();
		});
		const btnYes = document.getElementById('start-yes');
		const btnChange = document.getElementById('change-yes');
		
		btnYes.addEventListener('click', () => {
			saveStartTimeToServer();
		});
		btnChange.addEventListener('click', () => {
			changeUser();
		});
		
		// ì‚¬ìš©ì ì „í™˜
		function changeUser() {
			let userName = $("#userName2").val();
			if(userName == ""){
				alert("ì‚¬ìš©ìë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
				return;
			}
			$.ajax({
				url: '/change',
				type: 'POST',
				data: {
					userName	: userName
				},
				dataType: 'json',
				success: function (res) {
					if(res.data.RET_CODE == "NOT"){
						alert("ë“±ë¡ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.");
						return;
					} else {
						location.href="/";
					}
				},
				error: function () {
				}
			});
		}
		
		// ì‹œì‘ ì‹œê°„ ì„œë²„ ì €ì¥ (POST)
		function saveStartTimeToServer() {
			let userName = $("#userName").val();
			if(userName == ""){
				alert("ì‚¬ìš©ìë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
				return;
			}
			$.ajax({
				url: '/insert',
				type: 'POST',
				data: {
					userName	: userName
				},
				dataType: 'json',
				success: function (res) {
					if(res.data.RET_CODE == "DUPLE"){
						alert("ì´ë¯¸ ë“±ë¡ëœ ì‚¬ìš©ìì…ë‹ˆë‹¤.");
						return;
					} else {
						location.reload();
					}
				},
				error: function () {
					console.error('ì‹œì‘ ì‹œê°„ ì €ì¥ ì‹¤íŒ¨');
				}
			});
		}

		// ì‹œì‘ ì‹œê°„ ì„œë²„ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸° (GET)
		function loadStartTimeFromServer(callback) {
			$.ajax({
				url: '/load',
				type: 'GET',
				dataType: 'json',
				success: function (res) {
					if (res && res.data && res.data.regDt) {
						callback(res.data.regDt);
					} else {
						callback(null);
					}
				},
				error: function () {
					callback(null);
				}
			});
		}
		enterKey = function(type){
			if (window.event.keyCode == 13) {
				$('#start-yes').trigger("click");
			}
		}
		enterKey2 = function(type){
			if (window.event.keyCode == 13) {
				$('#change-yes').trigger("click");
			}
		}
		// ëª¨ë‹¬ ë‹«ê¸°
		$('#close-modal').on('click', function () {
			$('#start-modal').hide();
		});
		// ëª¨ë‹¬ ë‹«ê¸°
		$('#close-modal2').on('click', function () {
			$('#change-modal').hide();
		});
	</script>
</body>
</html>
